<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.leoyon.vote.house.dao.HouseDao">
	
	<insert id="add" parameterType="com.leoyon.vote.house.House" useGeneratedKeys="true" keyProperty="id">
		insert into basic_house (area_id,building,unit,number,house_type,house_status,remark,construction_area,net_area) values(
			#{areaId},#{building},#{unit},#{number},#{houseType},#{houseStatus},#{remark},#{constructionArea},#{netArea}
		);
	</insert>	
	
	<select id="find" parameterType="com.leoyon.vote.house.FindHouseRequest" resultType="com.leoyon.vote.house.House">
		select h.* from basic_house h
		<where>
			<if test="areaId != null">
				and h.area_id=#{areaId}
			</if>
			<if test="building != null">
				and h.building=#{building}
			</if>		
			<if test="unit != null">
				and h.unit=#{unit}
			</if>		
			<if test="unit != null">
				and h.number=#{number}
			</if>				
			<if test="houseType != null">
				and h.house_type=#{houseType}
			</if>			
			<if test="houseStatus != null">
				and h.house_status=#{houseStatus}
			</if>	
			<if test="ownerName != null and ownerName != ''">
				and h.id in (
					select house_id from basic_user_house hu
					join basic_user u on u.id=hu.user_id and u.real_name like '%${ownerName}%'
				)
			</if>	
			<if test="ownerMobile != null and ownerMobile != ''">
				and h.id in (
					select house_id from basic_user_house hu
					join basic_user u on u.id=hu.user_id and u.mobile=#{ownerMobile}
				)
			</if>	
		</where>
		order by h.date_create desc
		LIMIT #{page} , #{psize};
	</select>
	
	<update id="update" parameterType="com.leoyon.vote.house.House">
	update basic_house
	<set>
		<if test="areaId != null">
				area_id = #{areaId},
		</if>
		<if test="building != null">
				building = #{building},
		</if>		
		<if test="unit != null">
				unit = #{unit},
		</if>		
		<if test="number != null">
				number = #{number},
		</if>	
		<if test="houseType != null">
				house_type = #{houseType},
		</if>	
		<if test="houseStatus != null">
				house_status = #{houseStatus},
		</if>	
		<if test="remark != null and remark != ''">
				remark = #{remark},
		</if>	
		<if test="constructionArea != null">
			construction_area=#{constructionArea}
		</if>			
		<if test="netArea != null">
			net_area=#{netArea}
		</if>		
	</set>
	where id = #{id}	
	</update>
	
</mapper>
